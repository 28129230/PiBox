{% extends "base-user.html" %}

{% block css%}    
{% endblock %}
{% block js%}    
{% endblock %}


{% block on_ready%}    
{% endblock %}

{% block content %} 
<div class="pi-container"> 
    <div class="row ">
        <div class="box box-solid box-navy ">
            <div class="box-header">
                <i class="fa fa-h-square"></i>
                <h3 class="box-title">Document</h3>
            </div><!-- /.box-header -->
            <div class="box-body  ">


<div class="md-section-divider"></div>

<div class="md-section-divider"></div>

<h1 id="上传数据" data-anchor-id="jtvw">上传数据</h1>

<p data-anchor-id="6cpr"><strong>Datetime</strong> is ISO 8601, such as 2012-03-15T16:13:14 或者 <br>
2012-03-15 16:13:14。</p>

<div class="md-section-divider"></div>

<h2 id="开关传感器" data-anchor-id="q2sr">开关传感器</h2>

<table data-anchor-id="f64t" class="table table-striped-white table-bordered">
<thead>
<tr>
 <th>url</th>
 <th style="text-align:right;">作用</th>
 <th style="text-align:center;">方法</th>
 <th style="text-align:center;">请求参数</th>
 <th style="text-align:center;">返回参数</th>
</tr>
</thead>
<tbody><tr>
 <td>/API/sensor/{sensor_id}/datapoint/</td>
 <td style="text-align:right;">修改</td>
 <td style="text-align:center;">GET</td>
 <td style="text-align:center;">value<code>int</code></td>
 <td style="text-align:center;">{'msg'}</td>
</tr>
<tr>
 <td>/API/sensor/{sensor_id}/datapoint/get/</td>
 <td style="text-align:right;">查询</td>
 <td style="text-align:center;">GET</td>
 <td style="text-align:center;"></td>
 <td style="text-align:center;">{'msg', 'value'}</td>
</tr>
</tbody></table>


<div class="md-section-divider"></div>

<h2 id="数值传感器" data-anchor-id="52qw">数值传感器</h2>

<table data-anchor-id="svgz" class="table table-striped-white table-bordered">
<thead>
<tr>
 <th>url</th>
 <th style="text-align:center;">作用</th>
 <th style="text-align:center;">方法</th>
 <th style="text-align:center;">请求参数</th>
 <th style="text-align:center;">返回参数</th>
</tr>
</thead>
<tbody><tr>
 <td>/API/sensor/{sensor_id}/datapoint/</td>
 <td style="text-align:center;">新增</td>
 <td style="text-align:center;">GET</td>
 <td style="text-align:center;">key<code>datetime</code>，value<code>float</code></td>
 <td style="text-align:center;">{'msg'}</td>
</tr>
<tr>
 <td>/API/sensor/{sensor_id}/datapoint/</td>
 <td style="text-align:center;">新增</td>
 <td style="text-align:center;">POST</td>
 <td style="text-align:center;">[{'key' : <code>datetime</code>, 'value' : <code>float</code>}]</td>
 <td style="text-align:center;">{'msg'}</td>
</tr>
<tr>
 <td>/API/sensor/{sensor_id}/datapoint/get/</td>
 <td style="text-align:center;">查询</td>
 <td style="text-align:center;">GET</td>
 <td style="text-align:center;">key<code>datetime</code></td>
 <td style="text-align:center;">{'msg', 'value}</td>
</tr>
<tr>
 <td>/API/sensor/{sensor_id}/datapoint/edit/</td>
 <td style="text-align:center;">修改</td>
 <td style="text-align:center;">GET</td>
 <td style="text-align:center;">key<code>datetime</code>，value<code>float</code></td>
 <td style="text-align:center;">{'msg'}</td>
</tr>
<tr>
 <td>/API/sensor/{sensor_id}/datapoint/remove/</td>
 <td style="text-align:center;">删除</td>
 <td style="text-align:center;">GET</td>
 <td style="text-align:center;">key<code>datetime</code></td>
 <td style="text-align:center;">{'msg'}</td>
</tr>
<tr>
 <td>/API/sensor/{sensor_id}/datapoint/history/</td>
 <td style="text-align:center;">历史（时间段）</td>
 <td style="text-align:center;">GET</td>
 <td style="text-align:center;">start<code>datetime</code>, end<code>datetime</code>, interval<code>int(seconds）</code></td>
 <td style="text-align:center;">{'msg'， 'datapoint'=[{'value','key'}]</td>
</tr>
<tr>
 <td>/API/sensor/{sensor_id}/datapoint/history/</td>
 <td style="text-align:center;">历史（返回最新前二十条）</td>
 <td style="text-align:center;">GET</td>
 <td style="text-align:center;"></td>
 <td style="text-align:center;">{'msg'， 'datapoint'=[{'value','key'}]}</td>
</tr>
</tbody></table>


<p data-anchor-id="i89e">json data could be like this：</p>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted" data-anchor-id="it3n" style=""><ol class="linenums"><li class="L0"><code><span class="pln">    </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">      </span><span class="str">"key"</span><span class="pun">:</span><span class="str">"2012-03-15T16:13:14"</span><span class="pun">,</span></code></li><li class="L2"><code><span class="pln">      </span><span class="str">"value"</span><span class="pun">:</span><span class="lit">294.34</span></code></li><li class="L3"><code><span class="pln">    </span><span class="pun">}</span></code></li></ol></pre>

<p data-anchor-id="uufi">or</p>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted" data-anchor-id="3w5d" style=""><ol class="linenums"><li class="L0"><code><span class="pln">    </span><span class="pun">[</span></code></li><li class="L1"><code><span class="pln">      </span><span class="pun">{</span><span class="str">"key"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2012-06-15T14:00:00"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">:</span><span class="lit">315.01</span><span class="pun">},</span></code></li><li class="L2"><code><span class="pln">      </span><span class="pun">{</span><span class="str">"key"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2012-06-15T14:00:10"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">:</span><span class="lit">316.23</span><span class="pun">},</span></code></li><li class="L3"><code><span class="pln">      </span><span class="pun">{</span><span class="str">"key"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2012-06-15T14:00:20"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">:</span><span class="lit">317.26</span><span class="pun">},</span></code></li><li class="L4"><code><span class="pln">      </span><span class="pun">{</span><span class="str">"key"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2012-06-15T14:00:30"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">:</span><span class="lit">318</span><span class="pun">},</span></code></li><li class="L5"><code><span class="pln">      </span><span class="pun">{</span><span class="str">"key"</span><span class="pun">:</span><span class="pln"> </span><span class="str">"2012-06-15T14:00:40"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"value"</span><span class="pun">:</span><span class="lit">317</span><span class="pun">}</span></code></li><li class="L6"><code><span class="pln">    </span><span class="pun">]</span></code></li></ol></pre>

<div class="md-section-divider"></div>

<h2 id="图像传感器" data-anchor-id="b2eo">图像传感器</h2>

<p data-anchor-id="7g8l">暂未测试</p>

<div class="md-section-divider"></div>

<h2 id="example" data-anchor-id="3z2x">Example</h2>

<p data-anchor-id="6ojs">在sh/datapoint_tools下有数据的测试脚本，可以用来增删数据，也可以用来做例子。 <br>
<a href="https://github.com/wzyy2/PiBox/tree/master/PiBox/sh/datapoint_tools/switch.py" target="_blank">开关传感的读写脚本</a></p>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted" data-anchor-id="7q0x" style=""><ol class="linenums"><li class="L0"><code><span class="pln">    python </span><span class="kwd">switch</span><span class="pun">.</span><span class="pln">py</span></code></li></ol></pre>

<p data-anchor-id="dsvj"><a href="https://github.com/wzyy2/PiBox/tree/master/PiBox/sh/datapoint_tools/num.py" target="_blank">数据传感的CURD脚本</a></p>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted" data-anchor-id="7z2p" style=""><ol class="linenums"><li class="L0"><code><span class="pln">    python num</span><span class="pun">.</span><span class="pln">py</span></code></li></ol></pre>

<p data-anchor-id="tzn4">只要对这些脚本稍加修改，另外加上一些python代码就可以通过以下思路，实现自己的本地智能家居： <br>
* 通过串口等通讯模块，关联单片机，然后关联上native yeelink。 <br>
* 通过驱动读取树莓派所接模块的数据，然后上传数据到native yeelink。</p>

<div class="md-section-divider"></div>

<h1 id="callback" data-anchor-id="1bga">CallBack</h1>

<div class="md-section-divider"></div>

<h2 id="explain" data-anchor-id="l075">Explain</h2>

<p data-anchor-id="wnw8">Callback file是传感器满足条件后被调用的python代码文件名（比如callback_file=gpio.py)，同时文件需要放在PiBox/sh/callback/下。 <br>
不使用的话只需提供不存在的文件名或者保持为空即可。</p>

<p data-anchor-id="596v">对开关传感器来说，每一次开关数值点发生修改，callback_file都会被按如下格式调用</p>

<pre data-anchor-id="txbt"><code>    python callback_file sensor.name swtich_status(1 or 0)
</code></pre>

<p data-anchor-id="qgk6">对数值传感器来说,每一次新增或者修改的数值都会检查条件，如果满足条件，callback_file都会被按如下格式调用</p>

<pre data-anchor-id="2k15"><code>    python callback_file sensor.name value（溢出的数值） key（时间）
</code></pre>

<div class="md-section-divider"></div>

<h2 id="example-1" data-anchor-id="n0h4">Example</h2>

<p data-anchor-id="jjz9">在sh/callback下有两个文件实例可以直接使用</p>

<div class="md-section-divider"></div>

<h3 id="gpiopy" data-anchor-id="wefi">gpio.py</h3>

<pre data-anchor-id="s032"><code>import os,sys

cwd = os.path.dirname(os.path.abspath(__file__)) + '/..' + '/..'
sys.path.append(os.path.join(cwd, 'PiHome'))

from common import linux_gpio

print 'Sensor:', str(sys.argv[1])
print 'Value:', str(sys.argv[2])

GPIO_NUM = 23

print 'GPIO_BCM_NUM:', GPIO_NUM

gpio = linux_gpio.gpio(GPIO_NUM)
gpio.gpio_export()
gpio.write_gpio_direction('out')
gpio.write_gpio_value(sys.argv[2])
</code></pre>

<p data-anchor-id="5rdx">在需要的开关传感器下填入gpio.py,将文件的GPIO_NUM改成所需的gpio编号，每次开关状态改变，就会带动gpio改变。 <br>
直接使用这个脚本就可以通过web来控制简单电器</p>

<div class="md-section-divider"></div>

<h3 id="calloutpy" data-anchor-id="g5gq">callout.py</h3>

<pre data-anchor-id="9ewj"><code>import os,sys

print 'Sensor:', str(sys.argv[1])
print 'Value:', str(sys.argv[2])
print 'key:', str(sys.argv[3])
</code></pre>

<p data-anchor-id="zyli">在需要的数值传感器下填入callout.py和条件,数值发生改变时条件若满足，会发送debug信息到log里。 <br>
如果在下面按网上教程加入发邮件或者发微博代码，就可以实现监控报警的效果。</p>






            </div><!-- /.box-body -->

        </div><!-- /.box -->
    </div>
</div>
{% endblock %}